<section class="section section-medium">
	<div class="container">
		{% if errors %}
		{% for e in errors %}
		<div class="form-error-submit">&nbsp;&nbsp;{{ e }}</div>
		{% endfor %}
		{% endif %}

		<h1>
			{% if sub.id %}
			{% trans _('edición sub') %} &laquo;<a href="{{ sub.base_url }}m/{{ sub.name }}">{{ sub.name_long }}</a>&raquo;
			{% else %}
			{% trans _('nuevo sub') %}
			{% endif %}
		</h1>

		<form class="form form-edit" method="post" autocomplete="off" enctype="multipart/form-data">
			<input type="hidden" name="id" value="{{ sub.id }}"/>
			<input type="hidden" name="u" value="{{ current_user.user_id }}"/>
			<input type="hidden" name="created_from" value="{{ site.id }}"/>

			{% if ! current_user.admin %}

			{% if sub.name %}
			<input type="hidden" id="owner" name="owner" value="{{ sub.owner }}" />
			{% else %}
			<input type="hidden" id="owner" name="owner" value="{{ current_user.user_id }}" />
			{% endif %}

			{% endif %}

			<div class="input-row">
				<label for="name" class="title">{% trans _('nombre corto, sin espacios') %}</label>

				<input type="text" id="name" name="name" value="{{ sub.name }}" class="input" maxlength="12" pattern="\S{3,12}" required />

				{% if sub.id %}
				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="new_disabled" value="1" {% if extended.new_disabled %}checked{% endif %}>
						{% trans _("envíos deshabilitados") %}
					</label>
				</div>
				{% endif %}

				<a href="http://meneame.wikispaces.com/Subs" target="_blank"><i class="fa fa-question-circle"></i></a>
			</div>

			<div class="input-row">
				<label for="name_long" class="title">{% trans _('título') %}</label>
				<input type="text" id="name_long" name="name_long" value="{{ sub.name_long }}" class="input input-block" pattern=".{6,40}" maxlength="40" required />
			</div>

			{% if sub.id %}

			<div class="input-row">
				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="private" value="1" {% if sub.private %}checked{% endif %}/>
						{% trans _('privado') %}
					</label>
				</div>

				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="nsfw" value="1" {% if sub.nsfw %}checked{% endif %}/>
						{% trans _('nsfw') %}
					</label>
				</div>

				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="no_anti_spam" value="1" {% if extended.no_anti_spam %}checked{% endif %}/>
						{% trans _('deshabilitar control anti spam') %}
					</label>
				</div>

				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="allow_images" value="1" {% if extended.allow_images %}checked{% endif %}/>
						{% trans _('subir imagen') %}
					</label>
				</div>
			</div>

			<div class="input-row">
				<label class="title title-inline">{% trans _('enlace') %}</label>

				<div class="input-checkbox no-margin-left">
					<label>
						<input type="radio" name="no_link" value="0" {% if extended.no_link == 0 %}checked{% endif %}/>
						{% trans _('siempre') %}
					</label>
				</div>

				<div class="input-checkbox">
					<label>
						<input type="radio" name="no_link" value="1" {% if extended.no_link == 1 %}checked{% endif %}/>
						{% trans _('opcional (microblogging)') %}
					</label>
				</div>

				<div class="input-checkbox">
					<label>
						<input type="radio" name="no_link" value="2" {% if extended.no_link == 2 %}checked{% endif %}/>
						{% trans _('sin enlace (microblogging)') %}
					</label>
				</div>
			</div>

			<div class="input-row">
				<label for="page_mode" class="title title-inline">{% trans _('presentación de los comentarios') %}</label>

				<select id="page_mode" name="page_mode" class="input">
					{% for k, v in page_modes %}
					<option value="{{ v }}" {% if v == sub.page_mode %}selected{% endif %}>{{ k }}</option>
					{% endfor %}
				</select>
			</div>

			<hr />

			<div class="input-row">
				<label class="title">{% trans _('colores y logo de la cabecera') %}</label>
			</div>

			<div class="input-row">
				<div class="row">
					<div class="col-md-4">
						<label for="color1" class="title title-inline">{% trans _('título') %}:</label>
						<input type="text" id="color1" name="color1" value="{{ sub.color1 }}" class="input input-color-picker" pattern="#[a-fA-F\d]{6}" placeholder="#a0a0a0" maxlength="7" style="width: 90px" />
					</div>

					<div class="col-md-4">
						<label for="color2" class="title title-inline">{% trans _('fondo') %}:</label>
						<input type="text" id="color2" name="color2" value="{{ sub.color2 }}" class="input input-color-picker" pattern="#[a-fA-F\d]{6}" placeholder="#a0a0a0" maxlength="7" style="width: 90px" />
					</div>
				</div>
			</div>

			<div class="input-row">
				<label for="fileInput" class="title title-inline">{% trans _('Imagen logo') %}</label>

				<input type="hidden" name="MAX_FILE_SIZE" value="{{ globals.media_max_size }}"/>
				<input type="file" autocomplete="off" name="logo_image" id="fileInput" class="uploadFile" accept="image/*"/>

				<div class="droparea_info"></div>

				<script type="text/javascript">
				addPostCode(function () {
					$("#fileInput").nicefileinput({ title: "subir imagen de logo"});
					$('form').droparea({maxsize: {{ globals.media_max_size }} });
				});
				</script>

				{% if sub.media_size > 0 %}
				<div class="input-checkbox">
					<label>
						<input type="checkbox" name="logo_image_delete" value="1"/>
						{% trans _('Eliminar') %}
					</label>
				</div>
				{% endif %}
			</div>

			<hr />

			<div class="input-row">
				<label class="title">{% trans _('límites de entradilla') %}</label>
			</div>

			<div class="input-row">
				<div class="row">
					<div class="col-md-4">
						<label for="intro_min_len" class="title title-inline">{% trans _('longitud mínima') %}</label>
						<input type="number" id="intro_min_len" name="intro_min_len" class="input" min="0" max="200" value="{{ extended.intro_min_len }}" style="width: 60px" />
					</div>

					<div class="col-md-4">
						<label for="intro_max_len" class="title title-inline">{% trans _('longitud máxima') %}</label>
						<input type="number" id="intro_max_len" name="intro_max_len" class="input" min="0" max="5000" value="{{ extended.intro_max_len }}" style="width: 60px" />
					</div>
				</div>

				<div class="input-checkbox no-margin-left">
					<label>
						<input type="checkbox" name="allow_paragraphs" value="1" {% if extended.allow_paragraphs %}checked{% endif %}/>
						{% trans _('permitir párrafos') %}
					</label>
				</div>
			</div>

			<hr />

			<div class="input-row">
				<label class="title">{% trans _('mensajes') %}</label>
			</div>

			<div class="input-row">
				<label for="rules" class="title title-inline">{% trans _('reglas para el envío') %}</label><br />
				<textarea maxlength="300" name="rules" rows="5" id="rules" class="input input-block">{{ extended.rules }}</textarea>
			</div>

			<div class="input-row">
				<label for="message" class="title title-inline">{% trans _('mensaje barra lateral') %}</label><br />
				<textarea maxlength="3000" name="message" rows="5" id="message" class="input input-block">{{ extended.message }}</textarea>
			</div>

			<hr />

			<div class="input-row">
				<label class="title">
					{% trans _('conexión con Twitter') %}
					<a href="https://dev.twitter.com/oauth/overview/application-owner-access-tokens" target="_blank">
						<i class="fa fa-question-circle"></i>
					</a>
				</label>
			</div>

			<div class="input-row">
				<div class="row">
					<div class="col-md-3">
						<label for="twitter_page" class="title title-inline">{% trans _('perfil') %}</label>
					</div>

					<div class="col-md-9">
						<input type="url" value="{{ extended.twitter_page }}" placeholder="https://twitter.com/usuario" id="twitter_page" name="twitter_page" class="input input-block" maxlength="60"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="twitter_consumer_key" class="title title-inline">{% trans _('consumer key') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.twitter_consumer_key }}" autocomplete="off" placeholder="aaA1bBi..." id="twitter_consumer_key" name="twitter_consumer_key" class="input input-block" maxlength="32" pattern="[A-Za-z0-9\-]{20,32}"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="twitter_consumer_secret" class="title title-inline">{% trans _('consumer secret') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.twitter_consumer_secret }}" autocomplete="off" placeholder="aaA1bBi..." id="twitter_consumer_secret" name="twitter_consumer_secret" class="input input-block" maxlength="64" pattern="[A-Za-z0-9\-]{32,64}"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="twitter_token" class="title title-inline">{% trans _('token') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.twitter_token }}" autocomplete="off" placeholder="aaA1bBi-..." id="twitter_token" name="twitter_token" class="input input-block" maxlength="64" pattern="[A-Za-z0-9\-]{50,64}"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="twitter_token_secret" class="title title-inline">{% trans _('token secret') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.twitter_token_secret }}" autocomplete="off" placeholder="aaA1bBi..." id="twitter_token_secret" name="twitter_token_secret" class="input input-block" maxlength="64" pattern="[A-Za-z0-9\-]{32,64}"/>
					</div>
				</div>
			</div>

			{# Enabled facebook only to admins, for the time being, until Twitter is tested end perhaps improved #}
			{% if current_user.admin %}
			<div class="input-row">
				<label class="title">
					{% trans _('conexión con Facebook') %}
					<a href="https://developers.facebook.com/docs/facebook-login/access-tokens" target="_blank">
						<i class="fa fa-question-circle"></i>
					</a>
				</label>
			</div>

			<div class="input-row">
				<div class="row">
					<div class="col-md-3">
						<label for="facebook_page" class="title title-inline">{% trans _('página') %}</label>
					</div>

					<div class="col-md-9">
						<input type="url" value="{{ extended.facebook_page }}" placeholder="https://www.facebook.com/página" id="facebook_page" name="facebook_page" class="input input-block" maxlength="60"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="facebook_key" class="title title-inline">{% trans _('key') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.facebook_key }}" autocomplete="off" placeholder="aaA1bBi..." id="facebook_key" name="facebook_key" class="input input-block" maxlength="40" pattern="[A-Za-z0-9\-]{30,40}"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="facebook_secret" class="title title-inline">{% trans _('secret') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.facebook_secret }}" autocomplete="off" placeholder="aaA1bBi..." id="facebook_secret" name="facebook_secret" class="input input-block" maxlength="40" pattern="[A-Za-z0-9\-]{30,40}"/>
					</div>
				</div>

				<div class="row">
					<div class="col-md-3">
						<label for="facebook_token" class="title title-inline">{% trans _('token') %}</label>
					</div>

					<div class="col-md-9">
						<input type="text" value="{{ extended.facebook_token }}" autocomplete="off" placeholder="aaA1bBi-..." id="facebook_token" name="facebook_token" class="input input-block" maxlength="120" pattern="[A-Za-z0-9\-]{100,120}"/>
					</div>
				</div>
			</div>

			<hr />

			<div class="input-row">
				<label class="title">{% trans _('HTML al final de página') %}</label>
			</div>

			<div class="input-row">
				<textarea maxlength="2000" name="post_html" rows="4" id="post_html" class="input input-block">{{ extended.post_html | escape }}</textarea>
			</div>
			{% endif %} {# if current_user.admin #}

			{% endif %} {# sub.id #}

			{% if current_user.admin %}

			<div class="input-row">
				<label class="title">{% trans _('¡ALERTA admins! opciones delicadas') %}</label>
			</div>

			<div class="input-row">
				<div class="row">
					<div class="col-md-4">
						<div class="input-checkbox no-margin-left">
							<label>
								<input type="checkbox" name="enabled" value="1" {% if sub.enabled %}checked{% endif %} />
								{% trans _("habilitado") %}
							</label>
						</div>
					</div>

					<div class="col-md-4">
						<label for="owner" class="title title-inline">{% trans _('ID usuario') %}</label>

						{% if sub.name %}
						<input type="number" id="owner" name="owner" maxlength="10" pattern="[0-9]+" class="input" value="{{ sub.owner }}" />
						{% else %}
						<input type="number" id="owner" name="owner" maxlength="10" pattern="[0-9]+" class="input" value="{{ current_user.user_id }}" />
						{% endif %}
					</div>

					{% if sub.id > 0 %}
					<div class="col-md-4">
						<div class="input-checkbox no-margin-left">
							<label>
								<input type="checkbox" name="allow_main_link" value="1" {% if sub.allow_main_link %}checked{% endif %}> {% trans _("permitir enlace principal") %}
							</label>
						</div>
					</div>
					{% endif %}
				</div>
			</div>

			{% if copy_from OR candidates_from %}
			<div class="input-row">
				<div class="row">
					{% if copy_from %}
					<div class="col-md-6">
						<label class="title title-inline">{% trans _('copiar desde') %}</label>

						{% for c in copy_from %}
						<select name="copy_from[]" class="input input-block">
							<option value="{{ c.id }}" selected>{{ c.name }}</option>
							<option value="0">{% trans _('eliminar') %}</option>
						</select>
						{% endfor %}
					</div>
					{% endif %}

					{% if candidates_from %}
					<div class="col-md-6">
						<label class="title title-inline">{% trans _('añadir copiar desde') %}</label>

						<select name="copy_from[]" class="input input-block">
							<option value="0" selected>--</option>
							{% for c in candidates_from %}
							<option value="{{ c.id }}">{{ c.name }}</option>
							{% endfor %}
						</select>
					</div>
					{% endif %}
				</div>
			</div>
			{% endif %}

			{% endif %} {# if current_user.admin #}

			<footer class="footer">
				<button type="submit" class="button">{% trans _('guardar') %}</button>
			</footer>
		</form>
	</div>
</section>
